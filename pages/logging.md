<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /pages/mdsource/logging.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->
# Logging

By default some information is written to [Trace.WriteLine](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.trace.writeline#System_Diagnostics_Trace_WriteLine_System_String_System_String_)

 * The SqlLocalDb instance name when `SqlInstance` is instantiated.
 * The database name when a `SqlDatabase` is built.

To enable verbose logging use `LocalDbLogging`:

<!-- snippet: LocalDbLoggingUsage -->
```cs
LocalDbLogging.EnableVerbose();
```
<sup>[snippet source](/src/LocalDb.Tests/Snippets/LocalDbLoggingUsage.cs#L5-L7)</sup>
<!-- endsnippet -->

The full implementation is:

<!-- snippet: LocalDbLogging -->
```cs
/// <summary>
/// Controls the logging level.
/// </summary>
public static class LocalDbLogging
{
    /// <summary>
    /// Enable verbose logging to <see cref="Trace.WriteLine(string)"/>
    /// </summary>
    public static void EnableVerbose(bool sqlLogging = false)
    {
        if (WrapperCreated)
        {
            throw new Exception("`LocalDbLogging.EnableVerbose()` must be called prior to any `SqlInstance` being created.");
        }
        Enabled = true;
        SqlLoggingEnabled = sqlLogging;
    }

    internal static bool SqlLoggingEnabled;
    internal static bool Enabled;
    internal static bool WrapperCreated;

    internal static void Log(string message)
    {
        if (Enabled)
        {
            Trace.WriteLine(message, "LocalDb");
        }
    }
}
```
<sup>[snippet source](/src/LocalDb/LocalDbLogging.cs#L4-L35)</sup>
<!-- endsnippet -->

Which is then combined with [Fody MethodTimer](https://github.com/Fody/MethodTimer):

<!-- snippet: MethodTimeLogger -->
```cs
static class MethodTimeLogger
{
    public static void Log(MethodBase methodBase, long milliseconds, string message)
    {
        if (LocalDbLogging.Enabled)
        {
            Trace.WriteLine($"{methodBase.Name} {milliseconds}ms", "LocalDb");
        }
    }
}
```
<sup>[snippet source](/src/LocalDb/MethodTimeLogger.cs#L4-L15)</sup>
<!-- endsnippet -->


## SQL statements

SQL statements can be logged:

<!-- snippet: LocalDbLoggingUsageSqlLogging -->
```cs
LocalDbLogging.EnableVerbose(sqlLogging: true);
```
<sup>[snippet source](/src/LocalDb.Tests/Snippets/LocalDbLoggingUsage.cs#L8-L10)</sup>
<!-- endsnippet -->

And an example database creation message would be:

```
LocalDB: Executed SQL (87.ms):
    if db_id('Tests_SeedData') is null
        begin
            create database [Tests_SeedData] on
            (
                name = [Tests_SeedData],
                filename = 'D:\LocalDBData\TestDbContext\Tests_SeedData.mdf'
            ),
            (
                filename = 'D:\LocalDBData\TestDbContext\Tests_SeedData_log.ldf'
            )
            for attach;
        end;
    else
        begin
            alter database [Tests_SeedData] set online;
        end;
```

In EfLocalDb this will also log EntityFramework SQL statements.

So performing a `DbSet.FindAsync()` would result in:

```
LocalDB: Executed EF SQL command:
    Executed DbCommand (73ms) [Parameters=[@p0='prop' (Size = 4000)], CommandType='Text', CommandTimeout='30']
    SET NOCOUNT ON;
    INSERT INTO [TestEntities] ([Property])
    VALUES (@p0);
    SELECT [Id]
    FROM [TestEntities]
    WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
```


## Logging in xUnit

xUnit does not route `Trace.WriteLine` to [ITestOutputHelper](https://xunit.net/docs/capturing-output). Tracking issue: [3.0: Console / Trace / Debugger capture support ](https://github.com/xunit/xunit/issues/1730).

This can be worked around by [adding a Trace Listener](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.trace.listeners) that writes to `ITestOutputHelper`.

Or alternatively use XunitLogger: https://github.com/SimonCropp/XunitLogger.
