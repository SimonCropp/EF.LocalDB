<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /pages/mdsource/with-rollback.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# With Rollback

Multiple actions a targeted to the same database and changes are rolled back instead of being committed.

Characteristics:

 * Better performance that the standard API.
 * If a test fails, it is not possible to look at the current database state.

If a test has failed, to debug the database state, temporarily switch back to the standard API.


## Usage

<!-- snippet: WithRollback -->
<a id='06153cb0'></a>
```cs
var sqlInstance = new SqlInstance(
    name: "theInstanceName",
    buildTemplate: TestDbBuilder.CreateTable
);

await using var sqlDatabase = await sqlInstance.BuildWithRollback();
var connection = sqlDatabase.Connection;
//Use the connection
```
<sup><a href='/src/LocalDb.Tests/Snippets/WithRollback.cs#L8-L17' title='Snippet source file'>snippet source</a> | <a href='#06153cb0' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## EntityFramework Usage

<!-- snippet: EfWithRollback -->
<a id='c6165c1a'></a>
```cs
var sqlInstance = new SqlInstance<TheDbContext>(
    constructInstance: builder => new TheDbContext(builder.Options));

await using var sqlDatabase = await sqlInstance.BuildWithRollback();
var connection = sqlDatabase.Connection;
var data = sqlDatabase.Context;
//Use the Connection or TheDbContext
```
<sup><a href='/src/EfLocalDb.Tests/Snippets/WithRollback.cs#L8-L16' title='Snippet source file'>snippet source</a> | <a href='#c6165c1a' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->
